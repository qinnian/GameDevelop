# 【游戏开发】人工智能：群聚

## 一、写在前面

- 【内容来源】：《游戏开发中的人工智能》
- 【资源获取】：后台回复【GameAI】，获取电子书

## 群聚

通常在游戏中，有些非玩家角色必须群聚移动，而不是个别行动。举个例子，假设你在写角色扮演游戏，在主城镇外有一片绵羊的草地，如果你的绵羊是一整群的在吃草，而不是毫无目的的在闲逛，看起来会更真实些。

这种群体行为的核心就是基本的群聚算法，本章要详谈基本群聚算法，教你如何修改算法，用来处理诸如避开障碍物之类的情况。本章接下来将以“单位”代指组成群体的个别实体，例如：绵羊、鸟、等等。

基本的群聚算法来自于Craig Reynolds在1987年发表的论文《Flocks，Herds and Schools:A Distributed Behavioral Model》。在论文中，他提出基本群聚算法，用以仿真整群的鸟、鱼或其他生物。

算法的三个规则：

- 凝聚：每个单位都往其邻近单位的平均位置行动。
- 对齐：每个单位行动时，都要把自己对齐在其邻近单位的平均方向上。
- 分割：每个单位行动时，要避免撞上其邻近单位。

从这三条语句可以得知，每个单位都必须有比如运用转向力行进的能力。此外，每个单位都必须得知其局部的周遭情况，必须知道邻近单位在哪里、它们的方向如何以及它们和自身有多接近。

![](https://raw.githubusercontent.com/qinnian/FigureBed/master/20200303084238.png)

图4-1 是一个单位（图中用粗线表示的那个）以 r 为半径画弧而定出其可见视野的说明。任何其他单位落入这个弧内，都能被这个单位看见。运用群聚规则时，这些可视的单位就会有用，而其他单位都会被忽略。弧由两个参数定义：弧半径和角度 θ，这两个参数会影响最后的群聚行动。

弧半径：

较大的弧半径会让单位看到群体中更多的伙伴，从而产生更强的群体（也更多了）。也就是说，群体没有分裂成小群体的倾向，因为每个单位都可以看见多数邻近单位或全部邻近单位，再据此前进。另一方面，较小的半径会让整个群体分裂，形成较小群体的可能性较高。

角度 θ：

角度 θ 量定了每个单位的视野范围。最宽广的视野是360度，不过我们一般不这样做，因为这样最后得到的群聚行为可能会失真。常用的视野范围类似于图4-1 中，每个单位的身后都有一块看不见的区域。一般而言，视野宽广的话，如图4-2 左侧所示，视野角度约为270度，会得到组织良好的群体。视野较窄的话，如图4-2 右侧所示，视野角度约为45度，得到的群体像蚂蚁那样沿着单一路径行进。

